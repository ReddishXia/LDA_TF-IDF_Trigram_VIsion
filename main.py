import numpy as np
from sklearn.feature_extraction.text import CountVectorizer, TfidfTransformer
from sklearn.decomposition import LatentDirichletAllocation
from nltk.util import ngrams

# Load the data
documents = ["Today we have something a little different. Dr. Jane Goodall is going to tell you a story. Stay tuned after the animation to learn how to download this as a free children's book. Ready? Let's begin.It starts as a whisper, a word on the air. It can't quite be heard, but you know that it's there. As gentle as sunlight, as tenacious as hail, in its route to the heart, it could not but prevail. And the people looked up from their day-to-day tasks, their day-to-day jobs and their day-to-day masks. They heard or they felt where the whisper could lead, and they looked with eyes wide at what that might mean. And once they could see it, they hadn't a chance To resist the sweet song of the deep spell it cast. But the feeling it brought them at first glance was pain, as they lifted their eyes on the land they had claimed. Since they saw at last as if raised from a dream, they were almost alone on the land and the sea. For the trees had almost gone, and the bees had almost gone, and the creatures in their shells by the seas had almost gone. And the people felt sad as they saw their new Earth, but they knew this was it, one wild chance for rebirth. Breaking new ground, seeds rolling down, smell of the earth on your hands and your brow. No time for sorrow, we're building tomorrow. The sound of things growing now keeps us around. As the wildness grows, and the deep wood grows, and the sense that the future's come to meet you grows, There's no chance we can rest. We must do our best. This moment can lead us back home, that's our test. It starts as a whisper, a word on the air. It can't quite be heard, but you know that it's there. It then spoke like thunder. Until we all moved. And we could. And we did. And it's done. She's renewed.Help turn the whisper into a roar by sharing this poem today. You can download the illustrated book for free at ed.ted.com/whisper or keep your soul aflutter with one of these animated poems.",
             "When faced with a big challenge where potential failure seems to lurk at every corner, maybe you've heard this advice before: Be more confident. And most likely, this is what you think when you hear it: If only it were that simple. But what is confidence? Take the belief that you are valuable, worthwhile, and capable, also known as self-esteem, add in the optimism that comes when you are certain of your abilities, and then empowered by these, act courageously to face a challenge head-on. This is confidence. It turns thoughts into action.So where does confidence even come from? There are several factors that impact confidence. One: what you're born with, such as your genes, which will impact things like the balance of neurochemicals in your brain. Two: how you're treated. This includes the social pressures of your environment. And three: the part you have control over, the choices you make, the risks you take, and how you think about and respond to challenges and setbacks. It isn't possible to completely untangle these three factors, but the personal choices we make certainly play a major role in confidence development. So, by keeping in mind a few practical tips, we do actually have the power to cultivate our own confidence. Tip 1: a quick fix. There are a few tricks that can give you an immediate confidence boost in the short term. Picture your success when you're beginning a difficult task, something as simple as listening to music with deep bass; it can promote feelings of power. You can even strike a powerful pose or give yourself a pep talk. Tip two: believe in your ability to improve. If you're looking for a long-term change, consider the way you think about your abilities and talents. Do you think they are fixed at birth, or that they can be developed, like a muscle? These beliefs matter because they can influence how you act when you're faced with setbacks. If you have a fixed mindset, meaning that you think your talents are locked in place, you might give up, assuming you've discovered something you're not very good at. But if you have a growth mindset and think your abilities can improve, a challenge is an opportunity to learn and grow. Neuroscience supports the growth mindset. The connections in your brain do get stronger and grow with study and practice. It also turns out, on average, people who have a growth mindset are more successful, getting Better grades, and doing Better in the face of challenges. Tip three: practice failure. Face it, you're going to fail sometimes. Everyone does. J.K. Rowling was rejected by twelve different publishers before one picked up Harry Potter. The Wright Brothers built on history's failed attempts at flight, including some of their own, before designing a successful airplane.Studies show that those who fail regularly and keep trying anyway are Better equipped to respond to challenges and setbacks in a constructive way. They learn how to try different strategies, ask others for advice, and perservere. So, think of a challenge you want to take on, realize it's not going to be easy, accept that you'll make mistakes, and be kind to yourself when you do. Give yourself a pep talk, stand up, and go for it. The excitement you'll feel knowing that whatever the result, you'll have gained greater knowledge and understanding. This is confidence.",
             "This chimpanzee stumbles across a windfall of overripe plums. Many of them have split open, drawing him to their intoxicating fruity odor. He gorges himself and begins to experience some… strange effects. This unwitting ape has stumbled on a process that humans will eventually harness to create beer, wine, and other alcoholic drinks. The sugars in overripe fruit attract microscopic organisms known as yeasts. As the yeasts feed on the fruit sugars they produce a compound called ethanol— the type of alcohol in alcoholic beverages. This process is called fermentation.Nobody knows exactly when humans began to create fermented beverages. The earliest known evidence comes from 7,000 BCE in China, where residue in clay pots has revealed that people were making an alcoholic beverage from fermented rice, millet, grapes, and honey. Within a few thousand years, cultures all over the world were fermenting their own drinks. Ancient Mesopotamians and Egyptians made beer throughout the year from stored cereal grains. This beer was available to all social classes, and workers even received it in their daily rations. They also made wine, but because the climate wasn’t ideal for growing grapes, it was a rare and expensive delicacy. By contrast, in Greece and Rome, where grapes grew more easily, wine was as readily available as beer was in Egypt and Mesopotamia. Because yeasts will ferment basically any plant sugars, ancient peoples made alcohol from whatever crops and plants grew where they lived. In South America, people made chicha from grains, sometimes adding hallucinogenic herbs. In what’s now Mexico, pulque, made from cactus sap, was the drink of choice, while East Africans made banana and palm beer. And in the area that’s now Japan, people made sake from rice. Almost every region of the globe had its own fermented drinks. As alcohol consumption became part of everyday life, some authorities latched onto effects they perceived as positive— Greek physicians considered wine to be good for health, and poets testified to its creative qualities. Others were more concerned about alcohol’s potential for abuse. Greek philosophers promoted temperance. Early Jewish and Christian writers in Europe integrated wine into rituals but considered excessive intoxication a sin. And in the middle east, Africa, and Spain, an Islamic rule against praying while drunk gradually solidified into a general ban on alcohol. Ancient fermented beverages had relatively low alcohol content. At about 13% alcohol, the by-products wild yeasts generate during fermentation become toxic and kill them. When the yeasts die, fermentation stops and the alcohol content levels off. So for thousands of years, alcohol content was limited.That changed with the invention of a process called distillation. 9th century Arabic writings describe boiling fermented liquids to vaporize the alcohol in them. Alcohol boils at a lower temperature than water, so it vaporizes first. Capture this vapor, cool it down, and what’s left is liquid alcohol much more concentrated than any fermented beverage. At first, these stronger spirits were used for medicinal purposes. Then, spirits became an important trade commodity because, unlike beer and wine, they didn’t spoil. Rum made from sugar harvested in European colonies in the Caribbean became a staple for sailors and was traded to North America. Europeans brought brandy and gin to Africa and traded it for enslaved people, land, and goods like palm oil and rubber. Spirits became a form of money in these regions. During the Age of Exploration, spirits played a crucial role in long distance sea voyages. Sailing from Europe to east Asia and the Americas could take months, and keeping water fresh for the crews was a challenge. Adding a bucket of brandy to a water barrel kept water fresh longer because alcohol is a preservative that kills harmful microbes. So by the 1600s, alcohol had gone from simply giving animals a buzz to fueling global trade and exploration— along with all their consequences. As time went on, its role in human society would only get more complicated.",
             "15th century Europeans believed they had hit upon a miracle cure: a remedy for epilepsy, hemorrhage, bruising, nausea, and virtually any other medical ailment. This brown powder could be mixed into drinks, made into salves or eaten straight up. It was known as mumia and made by grinding up mummified human flesh. The word cannibal dates from the time of Christopher Columbus; in fact, Columbus may even have coined it himself. After coming ashore on the island of Guadaloupe, Columbus' initial reports back to the Queen of Spain described the indigenous people as friendly and peaceful— though he did mention rumors of a group called the Caribs, who made violent raids and then cooked and ate their prisoners. In response, Queen Isabella granted permission to capture and enslave anyone who ate human flesh. When the island failed to produce the gold Columbus was looking for, he began to label anyone who resisted his plundering and kidnapping as a Caribe. Somewhere along the way, the word Carib became Canibe and then Cannibal. First used by colonizers to dehumanize indigenous people, it has since been applied to anyone who eats human flesh. So the term comes from an account that wasn't based on hard evidence, but cannibalism does have a real and much more complex history. It has taken diverse forms— sometimes, as with mumia, it doesn't involved recognizable parts of the human body. The reasons for cannibalistic practices have varied, too. Across cultures and time periods, there's evidence of survival cannibalism, when people living through a famine, siege or ill-fated expedition had to either eat the bodies of the dead or starve to death themselves. But it's also been quite common for cultures to normalize some form of eating human flesh under ordinary circumstances. Because of false accounts like Columbus's, it's difficult to say exactly how common cultural cannibalism has been— but there are still some examples of accepted cannibalistic practices from within the cultures practicing them. Take the medicinal cannibalism in Europe during Columbus's time. Starting in the 15th century, the demand for mumia increased. At first, stolen mummies from Egypt supplied the mumia craze, but soon the demand was too great to be sustained on Egyptian mummies alone, and opportunists stole bodies from European cemeteries to turn into mumia. Use of mumia continued for hundreds of years. It was listed in the Merck index, a popular medical encyclopedia, into the 20th century. And ground up mummies were far from the only remedy made from human flesh that was common throughout Europe. Blood, in either liquid or powdered form, was used to treat epilepsy, while human liver, gall stones, oil distilled from human brains, and pulverized hearts were popular medical concoctions. In China, the written record of socially accepted cannibalism goes back almost 2,000 years. One particularly common form of cannibalism appears to have been filial cannibalism, where adult sons and daughters would offer a piece of their own flesh to their parents. This was typically offered as a last-ditch attempt to cure a sick parent, and wasn't fatal to their offspring— it usually involved flesh from the thigh or, less often, a finger. Cannibalistic funerary rites are another form of culturally sanctioned cannibalism. Perhaps the best-known example came from the Fore people of New Guinea. Through the mid-20th century, members of the community would, if possible, make their funerary preferences known in advance, sometimes requesting that family members gather to consume the body after death. Tragically, though these rituals honored the deceased, they also spread a deadly disease known as kuru through the community. Between the fictionalized stories, verifiable practices, and big gaps that still exist in our knowledge, there's no one history of cannibalism. But we do know that people have been eating each other, volunteering themselves to be eaten, and accusing others of eating people for millennia.",
             "One, two, three, four, five, six, seven, eight, nine, and zero. With just these ten symbols, we can write any rational number imaginable. But why these particular symbols? Why ten of them? And why do we arrange them the way we do? Numbers have been a fact of life throughout recorded history. Early humans likely counted animals in a flock or members in a tribe using body parts or tally marks. But as the complexity of life increased, along with the number of things to count, these methods were no longer sufficient. So as they developed, different civilizations came up with ways of recording higher numbers. Many of these systems, like Greek, Hebrew, and Egyptian numerals, were just extensions of tally marks with new symbols added to represent larger magnitudes of value. Each symbol was repeated as many times as necessary and all were added together. Roman numerals added another twist. If a numeral appeared before one with a higher value, it would be subtracted rather than added. But even with this innovation, it was still a cumbersome method for writing large numbers. The way to a more useful and elegant system lay in something called positional notation. Previous number systems needed to draw many symbols repeatedly and invent a new symbol for each larger magnitude. But a positional system could reuse the same symbols, assigning them different values based on their position in the sequence. Several civilizations developed positional notation independently, including the Babylonians, the Ancient Chinese, and the Aztecs. By the 8th century, Indian mathematicians had perfected such a system and over the next several centuries, Arab merchants, scholars, and conquerors began to spread it into Europe. This was a decimal, or base ten, system, which could represent any number using only ten unique glyphs. The positions of these symbols indicate different powers of ten, starting on the right and increasing as we move left. For example, the number 316 reads as 6x10^0 plus 1x10^1 plus 3x10^2. A key breakthrough of this system, which was also independently developed by the Mayans, was the number zero. Older positional notation systems that lacked this symbol would leave a blank in its place, making it hard to distinguish Between 63 and 603, or 12 and 120. The understanding of zero as both a value and a placeholder made for reliable and consistent notation. Of course, it's possible to use any ten symbols to represent the numerals zero through nine. For a long time, the glyphs varied regionally. Most scholars agree that our current digits evolved from those used in the North African Maghreb region of the Arab Empire. And by the 15th century, what we now know as the Hindu-Arabic numeral system had replaced Roman numerals in everyday life to become the most commonly used number system in the world.So why did the Hindu-Arabic system, along with so many others, use base ten? The most likely answer is the simplest. That also explains why the Aztecs used a base 20, or vigesimal system. But other bases are possible, too. Babylonian numerals were sexigesimal, or base 60. Any many people think that a base 12, or duodecimal system, would be a good idea. Like 60, 12 is a highly composite number that can be divided by two, three, four, and six, making it much Better for representing common fractions. In fact, both systems appear in our everyday lives, from how we measure degrees and time, to common measurements, like a dozen or a gross. And, of course, the base two, or binary system, is used in all of our digital devices, though programmers also use base eight and base 16 for more compact notation. So the next time you use a large number, think of the massive quantity captured in just these few symbols, and see if you can come up with a different way to represent it."]

# Preprocess the data
vectorizer = CountVectorizer(stop_words='english', ngram_range=(1,1))
X = vectorizer.fit_transform(documents)

features = vectorizer.get_feature_names_out()

tfidf_transformer = TfidfTransformer()
X_tfidf = tfidf_transformer.fit_transform(X)

# Apply LDA
lda = LatentDirichletAllocation(n_components=5, random_state=0)
lda.fit(X_tfidf)
print(lda.components_)
# Extract topic keywords
for topic_idx, topic in enumerate(lda.components_):
    print(f"Topic {topic_idx}:")
    topic_features = [features[i] for i in topic.argsort()[:-6:-1]]
    print(f"\tLDA keywords: {' '.join(topic_features)}")
    for j in np.argsort(lda.transform(X_tfidf)[:,topic_idx])[::-1][:5]:
        # print(j)
        doc_tfidf = X_tfidf[j].toarray()[0]
        doc_ngrams = set()
        for n in range(2,4):
            doc_ngrams.update([' '.join(ngram) for ngram in ngrams(documents[j].split(), n)])
        # doc_keywords = [features[index] for index in np.argsort(doc_tfidf)[::-1] if features[index] in doc_ngrams][:10]
        for index in np.argsort(doc_tfidf)[::-1]:
            if (features[index] in doc_ngrams):
                print(index)
                print(features[index])

        # print(np.argsort(doc_tfidf)[::-1])
        # print(f"\tDocument {j+1} keywords: {' '.join(doc_keywords)}")
        # print(f"\tDocument {j+1} keywords: {' '.join(doc_keywords)}")
print()